<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jura:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <style>
        body {
            font-family: Jura,serif;
            background-color: #f8f5eb;
            height: 100vh;
            justify-content: center;
            align-items: center;
        }
        .jura-<uniquifier> {
                   font-family: "Jura", sans-serif;
                   font-optical-sizing: auto;
                   font-weight: 33;
                   font-style: normal;
               }
    </style>
</head>

<body class="bg-light" style="background-image: url(image/Fondo.jpeg); background-size: cover; background-position: center;">
<!-- Header -->
<header>
    <!-- Inicio del menu -->
    <nav class="navbar navbar-expand-md navbar-light bg-light px-3" id="navMenu">
        <div class="container-fluid">
            <!-- icono o nombre -->

            <a class="navbar-brand" href="home.html">
                <i class="bi bi-calendar2-week"></i>
                <span class="navbar-brand h1">Turnify</span>
            </a>

            <!-- boton del menu -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- elementos del menu colapsable -->

            <div class="collapse navbar-collapse" id="menu" >
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="home.html">Servicios</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="calendario.html">Calendario</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" id="toggle-theme">Modo Claro</a>
                    </li>

                    <li class="navbar-toggler">
                        <a class="nav-link" href="usuario.html">Perfil</a>
                    </li>

                </ul>
                <i class="fas fa-usuario-circle fs-3"></i>

                <hr class="d-md-none text-white-50">

                <!-- enlaces redes sociales -->

                <ul class="navbar-nav flex-row flex-wrap text-light">

                    <li class="nav-item col-6 col-md-auto p-3">
                        <a class="text-black" href="https://github.com/marclecha05/ProyectoFinalGS.git">
                            <i class="bi bi-github"></i>
                            <small class="d-md-none ms-2">GitHub</small>
                        </a>
                    </li>

                </ul>

                <!--boton Informacion -->

                <form class="d-flex">
                    <a class="btn btn-outline-secondary d-none d-md-inline-block " type="submit" href="usuario.html">Perfil</a>
                </form>


            </div>

        </div>
    </nav>
</header>

<!-- Navbar secundaria -->
<nav class="navbar navbar-dark bg-secondary px-3">
    <a href="#" class="navbar-brand text-white">
        <i class="fas fa-hamburger"></i> Restaurantes
    </a>
    <a href="#" class="navbar-brand text-white">
        <i class="fas fa-hamburger"></i> Gimnasios
    </a>
    <a href="#" class="navbar-brand text-white">
        <i class="fas fa-hamburger"></i> Peluquerias
    </a>

</nav>

<!-- Sidebar y contenido -->
<div class="container-fluid mt-3">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3">
            <div class="list-group">
                <div class="input-group my-2">
                    <input type="text" id="searchProveedor" class="form-control" placeholder="Buscar...">
                    <div id="proveedorList" class="border p-2 mt-2" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- Panel derecho -->
        <div class="col-md-9">
            <div class="card p-3">
                <h5 id="servicioNombre" class="card-title">Seleccione un servicio</h5>
                <div id="selectProveedor" class="card bg-secondary text-white text-center p-5">
                    MAPA
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<script>
    let selectedService = "restaurante";
    let proveedores = [];

    function getProveedores() {
        $.get("/proveedores", (data) => {
            proveedores = data; // Guardamos los proveedores en una variable global
            renderProveedores();
        }).fail((error) => console.error("Error al obtener proveedores:", error));
    }

    function renderProveedores() {
        const sidebar = document.querySelector(".list-group");
        const searchInput = document.getElementById("searchProveedor");

        sidebar.innerHTML = `
        <div class="input-group my-2">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" class="form-control" placeholder="Buscar" oninput="filterProveedores()" id="searchProveedor">
        </div>`;

        let filtered = proveedores.filter(p => p.serviceType.toLowerCase() === selectedService);
        const query = searchInput?.value.toLowerCase() || "";

        if (query) {
            filtered = filtered.filter(p => p.serviceName.toLowerCase().includes(query));
        }

        if (filtered.length === 0) {
            const noResults = document.createElement("div");
            noResults.classList.add("list-group-item", "no-results");
            noResults.textContent = "No se encontraron resultados";
            sidebar.appendChild(noResults);
        } else {
            filtered.forEach(proveedor => {
                const btn = document.createElement("button");
                btn.classList.add("list-group-item", "list-group-item-action");
                btn.textContent = proveedor.serviceName; // Corregido: acceder a `proveedor` en vez de `data`
                btn.addEventListener("click", () => loadMap(proveedor.location, proveedor.serviceName));
                sidebar.appendChild(btn);
            });
        }
    }

    function filterProveedores() {
        const searchInput = document.getElementById("searchProveedor");
        const query = searchInput.value.toLowerCase();

        const filtered = proveedores.filter(p =>
            p.serviceType.toLowerCase() === selectedService &&
            p.serviceName.toLowerCase().includes(query)
        );

        const sidebar = document.querySelector(".list-group");
        sidebar.querySelectorAll("button.list-group-item-action").forEach(button => {
            const buttonText = button.textContent.toLowerCase();
            button.style.display = buttonText.includes(query) ? "block" : "none";
        });

        // Si no hay resultados visibles, mostrar mensaje
        const visibleButtons = [...sidebar.querySelectorAll("button.list-group-item-action")]
            .filter(b => b.style.display !== "none");

        let noResults = sidebar.querySelector(".no-results");

        if (visibleButtons.length === 0) {
            if (!noResults) {
                noResults = document.createElement("div");
                noResults.classList.add("list-group-item", "no-results");
                noResults.textContent = "No se encontraron resultados";
                sidebar.appendChild(noResults);
            }
        } else if (noResults) {
            noResults.remove();
        }
    }

    function loadMap(location, serviceName) {
        const mapContainer = document.querySelector(".card.bg-secondary");
        const servicioNombreElement = document.getElementById("servicioNombre");

        if (servicioNombreElement) {
            servicioNombreElement.textContent = serviceName;
        }

        mapContainer.innerHTML = `
        <iframe width="100%" height="400" frameborder="0"
        style="border:0"
        src="https://www.google.com/maps?q=${location}&output=embed"
        allowfullscreen></iframe>
        <h5 class="card-title mt-2">${serviceName}</h5>`;
    }

    // Manejo de clicks en la barra de navegación para cambiar de servicio
    document.querySelectorAll(".navbar-brand").forEach(item => {
        item.addEventListener("click", (event) => {
            event.preventDefault();

            if (event.target.textContent.includes("Restaurantes")) {
                selectedService = "restaurante";
            } else if (event.target.textContent.includes("Gimnasios")) {
                selectedService = "gimnasio";
            } else if (event.target.textContent.includes("Peluquerias")) {
                selectedService = "peluqueria";
            }

            renderProveedores();
        });
    });

    // Inicialización
    document.addEventListener("DOMContentLoaded", () => {
        getProveedores();
    });

</script>